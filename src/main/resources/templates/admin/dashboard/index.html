<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layoutAdmin}">
<head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            // Trích xuất dữ liệu từ bảng HTML
            var table = document.getElementById("data-table");
            var productMap = {};

            // Bỏ qua hàng đầu tiên (đầu đề)
            for (var i = 1, row; row = table.rows[i]; i++) {
                var productName = row.cells[0].innerText;
                var quantity = parseInt(row.cells[1].innerText); // Chuyển đổi thành số

                if (productMap[productName]) {
                    productMap[productName] += quantity;
                } else {
                    productMap[productName] = quantity;
                }
            }

            // Chuyển đổi productMap thành mảng để dùng cho Google Charts
            var dataRows = [];
            for (var product in productMap) {
                if (productMap.hasOwnProperty(product)) {
                    dataRows.push([product, productMap[product]]);
                }
            }

            // Tạo bảng dữ liệu cho Google Charts
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Product');
            data.addColumn('number', 'Quantity');
            data.addRows(dataRows);

            var options = {
                title: 'Cac Dong Ho Da Ban Duoc'
            };

            var chart = new google.visualization.PieChart(document.getElementById('piechart'));
            chart.draw(data, options);
        }
    </script>
</head>
<body>
<div layout:fragment="content">
    <div id="piechart" style="width: 900px; height: 500px;"></div>

    <!-- Bảng dữ liệu sinh ra bởi Thymeleaf -->
    <table id="data-table" style="display: none;">
        <thead>
        <tr>
            <th>Product Name</th>
            <th>Quantity</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="item : ${lstOrderDetail}">
            <td th:text="${item.product.name}" class="text-center text-muted"></td>
            <td th:text="${item.quantity}" class="text-center text-muted"></td>
        </tr>
        </tbody>
    </table>
</div>

</body>
</html>
